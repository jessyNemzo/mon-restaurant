<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Commander en Ligne - Le Bistrot Parisien</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="assets/images/favicon.ico">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>/* Page Commander */
.order-hero {
    height: 50vh;
    background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), 
                url('assets/images/hero-bg.jpg');
    background-size: cover;
    background-position: center;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: white;
    margin-top: 80px;
}

.order-content {
    padding: 50px 0;
    background: var(--light-color);
}

.order-grid {
    display: grid;
    grid-template-columns: 400px 1fr;
    gap: 40px;
    align-items: start;
}

/* Panier */
.cart-sidebar {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    padding: 30px;
    position: sticky;
    top: 100px;
}

.cart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--light-color);
}

.cart-header h2 {
    font-size: 1.5rem;
    color: var(--dark-color);
    display: flex;
    align-items: center;
    gap: 10px;
}

.cart-count {
    background: var(--primary-color);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.9rem;
}

.cart-items {
    min-height: 200px;
    margin-bottom: 20px;
}

.empty-cart {
    text-align: center;
    padding: 40px 20px;
    color: #999;
}

.empty-cart i {
    font-size: 3rem;
    margin-bottom: 15px;
    opacity: 0.5;
}

.cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid var(--light-color);
}

.cart-item:last-child {
    border-bottom: none;
}

.item-details h4 {
    margin-bottom: 5px;
    font-size: 1rem;
}

.item-details .item-price {
    color: var(--primary-color);
    font-weight: bold;
}

.item-controls {
    display: flex;
    align-items: center;
    gap: 10px;
}

.item-qty {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--light-color);
    border-radius: 20px;
    padding: 4px 12px;
}

.qty-btn-small {
    background: none;
    border: none;
    font-size: 1.2rem;
    cursor: pointer;
    color: var(--primary-color);
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.qty-btn-small:hover {
    background: var(--primary-color);
    color: white;
}

.remove-item {
    background: none;
    border: none;
    color: #ff4444;
    cursor: pointer;
    font-size: 1.2rem;
    margin-left: 10px;
}

.cart-summary {
    border-top: 2px solid var(--light-color);
    padding-top: 20px;
}

.summary-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    font-size: 1rem;
}

.summary-row.total {
    font-size: 1.3rem;
    font-weight: bold;
    color: var(--primary-color);
    border-top: 1px solid var(--light-color);
    padding-top: 10px;
    margin-top: 10px;
}

.checkout-btn {
    width: 100%;
    padding: 15px;
    background: #25D366;
    color: white;
    border: none;
    border-radius: var(--border-radius);
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    transition: var(--transition);
    margin: 20px 0;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.checkout-btn:hover:not(:disabled) {
    background: #128C7E;
    transform: translateY(-2px);
}

.checkout-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
    transform: none;
}

.delivery-info {
    background: var(--light-color);
    padding: 15px;
    border-radius: var(--border-radius);
    font-size: 0.9rem;
}

.delivery-info p {
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.delivery-info i {
    color: var(--primary-color);
}

/* Cartes de plats pour commander */
.dish-card-order {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    overflow: hidden;
    transition: var(--transition);
    display: flex;
    height: 200px;
}

.dish-card-order:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.15);
}

.dish-image {
    width: 200px;
    flex-shrink: 0;
}

.dish-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.dish-info {
    padding: 20px;
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.dish-info h3 {
    font-size: 1.2rem;
    margin-bottom: 8px;
    color: var(--dark-color);
}

.dish-info p {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 10px;
    flex: 1;
}

.dish-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.price {
    font-size: 1.3rem;
    font-weight: bold;
    color: var(--primary-color);
}

.allergenes {
    font-size: 0.8rem;
    color: #999;
}

.quantity-controls {
    display: flex;
    align-items: center;
    gap: 10px;
}

.qty-btn {
    width: 35px;
    height: 35px;
    border: 2px solid var(--primary-color);
    background: white;
    color: var(--primary-color);
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.qty-btn:hover {
    background: var(--primary-color);
    color: white;
}

.quantity {
    min-width: 30px;
    text-align: center;
    font-weight: bold;
    font-size: 1.1rem;
}

.add-to-cart {
    flex: 1;
    padding: 10px 15px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-weight: bold;
    transition: var(--transition);
    margin-left: 10px;
}

.add-to-cart:hover {
    background: #A52A2A;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
}

.modal-content {
    background-color: white;
    margin: 15% auto;
    padding: 30px;
    border-radius: var(--border-radius);
    width: 90%;
    max-width: 400px;
    text-align: center;
    position: relative;
}

.close-modal {
    position: absolute;
    right: 15px;
    top: 15px;
    font-size: 1.5rem;
    cursor: pointer;
    color: #999;
}

.modal-header {
    margin-bottom: 20px;
}

.modal-header i {
    font-size: 3rem;
    color: #25D366;
    margin-bottom: 15px;
}

/* Responsive */
@media (max-width: 1024px) {
    .order-grid {
        grid-template-columns: 1fr;
        gap: 30px;
    }
    
    .cart-sidebar {
        position: static;
        order: 2;
    }
    
    .menu-cards {
        order: 1;
    }
}

@media (max-width: 768px) {
    .dish-card-order {
        flex-direction: column;
        height: auto;
    }
    
    .dish-image {
        width: 100%;
        height: 200px;
    }
    
    .order-hero {
        height: 40vh;
    }
    
    .order-hero h1 {
        font-size: 2rem;
    }
}


/* Images dans le panier */
.cart-item {
    display: flex;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid var(--light-color);
    gap: 15px;
}

.item-image {
    width: 50px;
    height: 50px;
    border-radius: 8px;
    overflow: hidden;
    flex-shrink: 0;
}

.item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.item-details {
    flex: 1;
}

.item-details h4 {
    margin-bottom: 5px;
    font-size: 0.95rem;
    line-height: 1.3;
}

.item-price {
    color: var(--primary-color);
    font-weight: bold;
    font-size: 0.9rem;
}

.item-controls {
    display: flex;
    align-items: center;
    gap: 10px;
}</style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <h2>Le Bistrot Parisien</h2>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Accueil</a></li>
                <li><a href="menu.html">Notre Carte</a></li>
                <li><a href="commande.html" class="active">Commander</a></li>
                <li><a href="about.html">À Propos</a></li>
                <li><a href="contact.html">Contact & Réservation </a></li>
            </ul>
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <section class="order-hero">
        <div class="container">
            <h1>Commander en Ligne</h1>
            <p>Livraison et à emporter - Paiement sécurisé</p>
        </div>
    </section>

    <section class="order-content">
        <div class="container">
            <div class="order-grid">
                <!-- Panier -->
                <div class="cart-sidebar">
                    <div class="cart-header">
                        <h2><i class="fas fa-shopping-cart"></i> Votre Panier</h2>
                        <span class="cart-count">0 article(s)</span>
                    </div>
                    
                    <div class="cart-items" id="cartItems">
                        <!-- Les articles du panier apparaîtront ici -->
                        <div class="empty-cart">
                            <i class="fas fa-shopping-basket"></i>
                            <p>Votre panier est vide</p>
                            <small>Ajoutez des plats pour commander</small>
                        </div>
                    </div>

                    <div class="cart-summary">
                        <div class="summary-row">
                            <span>Sous-total:</span>
                            <span id="subtotal">0,00€</span>
                        </div>
                        <div class="summary-row">
                            <span>Livraison:</span>
                            <span id="delivery">3,50€</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total:</span>
                            <span id="total">3,50€</span>
                        </div>
                        
                        <button class="checkout-btn" id="checkoutBtn" disabled>
                            <i class="fab fa-whatsapp"></i>
                            Commander sur WhatsApp
                        </button>
                        
                        <div class="delivery-info">
                            <p><i class="fas fa-info-circle"></i> Livraison sous 45min</p>
                            <p><i class="fas fa-credit-card"></i> Paiement à la livraison</p>
                        </div>
                    </div>
                </div>

                <!-- Menu des plats -->
                <div class="menu-cards">
                    <!-- Entrées -->
                    <div class="menu-category">
                        <h2><i class="fas fa-utensils"></i> Entrées</h2>
                        <div class="dishes-grid">
                            <div class="dish-card-order">
                                <div class="dish-image">
                                    <img src="assets/images/plat-signature-1.jpg" alt="Soupe à l'Oignon">
                                </div>
                                <div class="dish-info">
                                    <h3>Soupe à l'Oignon Gratinée</h3>
                                    <p>Oignons caramélisés, bouillon de bœuf, croûtons et fromage gruyère</p>
                                    <div class="dish-meta">
                                        <span class="price">12€</span>
                                        <span class="allergenes">🥛 🌾</span>
                                    </div>
                                    <div class="quantity-controls">
                                        <button class="qty-btn minus" onclick="updateQuantity('soupe-oignon', -1)">-</button>
                                        <span class="quantity" id="qty-soupe-oignon">0</span>
                                        <button class="qty-btn plus" onclick="updateQuantity('soupe-oignon', 1)">+</button>
                                        <button class="add-to-cart" onclick="addToCart('soupe-oignon', 'Soupe à l\'Oignon Gratinée', 12, 'soupe-oignon')">
                                            Ajouter
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="dish-card-order">
                                <div class="dish-image">
                                    <img src="assets/images/plat-signature-2.jpg" alt="Tartare de Saumon">
                                </div>
                                <div class="dish-info">
                                    <h3>Tartare de Saumon et Avocat</h3>
                                    <p>Saumon frais, avocat crémeux, citron vert et aneth</p>
                                    <div class="dish-meta">
                                        <span class="price">16€</span>
                                        <span class="allergenes">🐟</span>
                                    </div>
                                    <div class="quantity-controls">
                                        <button class="qty-btn minus" onclick="updateQuantity('tartare-saumon', -1)">-</button>
                                        <span class="quantity" id="qty-tartare-saumon">0</span>
                                        <button class="qty-btn plus" onclick="updateQuantity('tartare-saumon', 1)">+</button>
                                        <button class="add-to-cart" onclick="addToCart('tartare-saumon', 'Tartare de Saumon et Avocat', 16, 'tartare-saumon')">
                                            Ajouter
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Plats Principaux -->
                    <div class="menu-category">
                        <h2><i class="fas fa-drumstick-bite"></i> Plats Principaux</h2>
                        <div class="dishes-grid">
                            <div class="dish-card-order">
                                <div class="dish-image">
                                    <img src="assets/images/plat-signature-1.jpg" alt="Bœuf Bourguignon">
                                </div>
                                <div class="dish-info">
                                    <h3>Bœuf Bourguignon</h3>
                                    <p>Bœuf mijoté au vin rouge, lardons, champignons et petits oignons</p>
                                    <div class="dish-meta">
                                        <span class="price">28€</span>
                                        <span class="allergenes">🥛 🌾</span>
                                    </div>
                                    <div class="quantity-controls">
                                        <button class="qty-btn minus" onclick="updateQuantity('boeuf-bourguignon', -1)">-</button>
                                        <span class="quantity" id="qty-boeuf-bourguignon">0</span>
                                        <button class="qty-btn plus" onclick="updateQuantity('boeuf-bourguignon', 1)">+</button>
                                        <button class="add-to-cart" onclick="addToCart('boeuf-bourguignon', 'Bœuf Bourguignon', 28, 'boeuf-bourguignon')">
                                            Ajouter
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="dish-card-order">
                                <div class="dish-image">
                                    <img src="assets/images/plat-signature-2.jpg" alt="Confit de Canard">
                                </div>
                                <div class="dish-info">
                                    <h3>Confit de Canard</h3>
                                    <p>Cuisses de canard confites, pommes de terre sautées à l'ail</p>
                                    <div class="dish-meta">
                                        <span class="price">26€</span>
                                    </div>
                                    <div class="quantity-controls">
                                        <button class="qty-btn minus" onclick="updateQuantity('confit-canard', -1)">-</button>
                                        <span class="quantity" id="qty-confit-canard">0</span>
                                        <button class="qty-btn plus" onclick="updateQuantity('confit-canard', 1)">+</button>
                                        <button class="add-to-cart" onclick="addToCart('confit-canard', 'Confit de Canard', 26, 'confit-canard')">
                                            Ajouter
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="dish-card-order">
                                <div class="dish-image">
                                    <img src="assets/images/plat-signature-3.jpg" alt="Risotto aux Cèpes">
                                </div>
                                <div class="dish-info">
                                    <h3>Risotto aux Cèpes</h3>
                                    <p>Risotto crémeux aux cèpes de saison et parmesan (Végétarien)</p>
                                    <div class="dish-meta">
                                        <span class="price">24€</span>
                                        <span class="allergenes">🥛</span>
                                    </div>
                                    <div class="quantity-controls">
                                        <button class="qty-btn minus" onclick="updateQuantity('risotto-cepes', -1)">-</button>
                                        <span class="quantity" id="qty-risotto-cepes">0</span>
                                        <button class="qty-btn plus" onclick="updateQuantity('risotto-cepes', 1)">+</button>
                                        <button class="add-to-cart" onclick="addToCart('risotto-cepes', 'Risotto aux Cèpes', 24, 'risotto-cepes')">
                                            Ajouter
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Desserts -->
                    <div class="menu-category">
                        <h2><i class="fas fa-ice-cream"></i> Desserts</h2>
                        <div class="dishes-grid">
                            <div class="dish-card-order">
                                <div class="dish-image">
                                    <img src="assets/images/plat-signature-1.jpg" alt="Crème Brûlée">
                                </div>
                                <div class="dish-info">
                                    <h3>Crème Brûlée à la Vanille</h3>
                                    <p>Crème onctueuse à la vanille de Madagascar et sa croque caramélisée</p>
                                    <div class="dish-meta">
                                        <span class="price">10€</span>
                                        <span class="allergenes">🥛</span>
                                    </div>
                                    <div class="quantity-controls">
                                        <button class="qty-btn minus" onclick="updateQuantity('creme-brulee', -1)">-</button>
                                        <span class="quantity" id="qty-creme-brulee">0</span>
                                        <button class="qty-btn plus" onclick="updateQuantity('creme-brulee', 1)">+</button>
                                        <button class="add-to-cart" onclick="addToCart('creme-brulee', 'Crème Brûlée à la Vanille', 10, 'creme-brulee')">
                                            Ajouter
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="dish-card-order">
                                <div class="dish-image">
                                    <img src="assets/images/plat-signature-2.jpg" alt="Soufflé au Chocolat">
                                </div>
                                <div class="dish-info">
                                    <h3>Soufflé au Chocolat</h3>
                                    <p>Soufflé léger au chocolat noir Valrhona et zestes d'orange</p>
                                    <div class="dish-meta">
                                        <span class="price">14€</span>
                                    </div>
                                    <div class="quantity-controls">
                                        <button class="qty-btn minus" onclick="updateQuantity('souffle-chocolat', -1)">-</button>
                                        <span class="quantity" id="qty-souffle-chocolat">0</span>
                                        <button class="qty-btn plus" onclick="updateQuantity('souffle-chocolat', 1)">+</button>
                                        <button class="add-to-cart" onclick="addToCart('souffle-chocolat', 'Soufflé au Chocolat', 14, 'souffle-chocolat')">
                                            Ajouter
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal de confirmation -->
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <div class="modal-header">
                <i class="fas fa-check-circle"></i>
                <h2>Commande Ajoutée au Panier !</h2>
            </div>
            <p>Votre plat a été ajouté au panier avec succès.</p>
            <button class="cta-button" onclick="closeModal()">Continuer mes achats</button>
            <button class="secondary-button" onclick="scrollToCart()">Voir mon panier</button>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Le Bistrot Parisien</h3>
                    <p>Cuisine française authentique - Livraison et à emporter</p>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p><i class="fas fa-map-marker-alt"></i> 12 Rue du Gourmet, 75008 Paris</p>
                    <p><i class="fas fa-phone"></i> +33 1 45 67 89 10</p>
                    <p><i class="fab fa-whatsapp"></i> Commander sur WhatsApp</p>
                </div>
                <div class="footer-section">
                    <h4>Horaires Livraison</h4>
                    <p>Lun-Dim: 11h30-14h30 • 18h30-22h30</p>
                    <p>Livraison sous 45min</p>
                </div>
            </div>
        </div>
    </footer>
    <script>// Panier d'achat
// Panier d'achat
let cart = [];
const deliveryFee = 3.50;

// Numéro WhatsApp du vendeur - MODIFIÉ AVEC VOTRE NUMÉRO
const whatsappNumber = "24107707462"; // Format: 24107707462 (sans le +)

// Images des plats - AJOUT DE CET OBJET
const dishImages = {
    'soupe-oignon': 'assets/images/plat-signature-1.jpg',
    'tartare-saumon': 'assets/images/plat-signature-2.jpg',
    'boeuf-bourguignon': 'assets/images/plat-signature-1.jpg',
    'confit-canard': 'assets/images/plat-signature-2.jpg',
    'risotto-cepes': 'assets/images/plat-signature-3.jpg',
    'creme-brulee': 'assets/images/plat-signature-1.jpg',
    'souffle-chocolat': 'assets/images/plat-signature-2.jpg'
};

// Quantités des plats
let quantities = {
    'soupe-oignon': 0,
    'tartare-saumon': 0,
    'boeuf-bourguignon': 0,
    'confit-canard': 0,
    'risotto-cepes': 0,
    'creme-brulee': 0,
    'souffle-chocolat': 0
};

// Mettre à jour la quantité affichée
function updateQuantity(itemId, change) {
    quantities[itemId] = Math.max(0, quantities[itemId] + change);
    document.getElementById(`qty-${itemId}`).textContent = quantities[itemId];
}

// Ajouter au panier - MODIFIÉ POUR INCLURE LES IMAGES
function addToCart(itemId, name, price, quantityId) {
    const quantity = quantities[itemId];
    
    if (quantity === 0) {
        alert('Veuillez sélectionner une quantité');
        return;
    }

    // Vérifier si l'article est déjà dans le panier
    const existingItemIndex = cart.findIndex(item => item.id === itemId);
    
    if (existingItemIndex > -1) {
        // Mettre à jour la quantité
        cart[existingItemIndex].quantity += quantity;
    } else {
        // Ajouter un nouvel article AVEC L'IMAGE
        cart.push({
            id: itemId,
            name: name,
            price: price,
            quantity: quantity,
            image: dishImages[itemId] // AJOUT DE L'IMAGE
        });
    }

    // Réinitialiser la quantité
    quantities[itemId] = 0;
    document.getElementById(`qty-${itemId}`).textContent = '0';

    // Mettre à jour l'affichage du panier
    updateCartDisplay();
    
    // Afficher le modal de confirmation
    showModal();
}

// NOUVELLE FONCTION : Générer une image récapitulative
async function generateOrderImage() {
    return new Promise((resolve) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        // Dimensions de l'image
        canvas.width = 800;
        canvas.height = 400 + (cart.length * 60);
        
        // Fond blanc
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // En-tête
        ctx.fillStyle = '#8B0000';
        ctx.fillRect(0, 0, canvas.width, 100);
        
        // Titre
        ctx.fillStyle = '#ffffff';
        ctx.font = 'bold 28px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('COMMANDE - LE BISTROT PARISIEN', canvas.width/2, 45);
        ctx.font = '18px Arial';
        ctx.fillText('Récapitulatif visuel de la commande', canvas.width/2, 75);
        
        // Date
        ctx.fillStyle = '#666666';
        ctx.font = '14px Arial';
        ctx.textAlign = 'right';
        ctx.fillText(new Date().toLocaleDateString('fr-FR'), canvas.width - 30, 95);
        
        // Articles de la commande
        let yPosition = 140;
        cart.forEach((item, index) => {
            // Fond alterné pour meilleure lisibilité
            if (index % 2 === 0) {
                ctx.fillStyle = '#f8f8f8';
                ctx.fillRect(30, yPosition - 10, canvas.width - 60, 50);
            }
            
            // Nom du plat
            ctx.fillStyle = '#333333';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(item.name, 50, yPosition + 10);
            
            // Quantité et prix
            ctx.fillStyle = '#666666';
            ctx.font = '14px Arial';
            ctx.fillText(`Quantité: ${item.quantity}x`, 400, yPosition + 10);
            
            // Prix total pour l'article
            ctx.fillStyle = '#8B0000';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'right';
            ctx.fillText(`${(item.price * item.quantity).toFixed(2)}€`, canvas.width - 50, yPosition + 10);
            
            yPosition += 50;
        });
        
        // Ligne de séparation
        ctx.strokeStyle = '#cccccc';
        ctx.beginPath();
        ctx.moveTo(50, yPosition + 10);
        ctx.lineTo(canvas.width - 50, yPosition + 10);
        ctx.stroke();
        
        // Totaux
        yPosition += 40;
        const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const total = subtotal + deliveryFee;
        
        ctx.fillStyle = '#333333';
        ctx.font = '16px Arial';
        ctx.textAlign = 'right';
        ctx.fillText('Sous-total:', canvas.width - 150, yPosition);
        ctx.fillText(`${subtotal.toFixed(2)}€`, canvas.width - 50, yPosition);
        
        ctx.fillText('Frais de livraison:', canvas.width - 150, yPosition + 30);
        ctx.fillText(`${deliveryFee.toFixed(2)}€`, canvas.width - 50, yPosition + 30);
        
        ctx.font = 'bold 20px Arial';
        ctx.fillStyle = '#8B0000';
        ctx.fillText('TOTAL:', canvas.width - 150, yPosition + 70);
        ctx.fillText(`${total.toFixed(2)}€`, canvas.width - 50, yPosition + 70);
        
        // Convertir en base64
        const dataURL = canvas.toDataURL('image/jpeg', 0.9);
        resolve(dataURL);
    });
}

// NOUVELLE FONCTION : Télécharger l'image
function downloadOrderImage(dataURL) {
    const link = document.createElement('a');
    link.download = `commande-${new Date().getTime()}.jpg`;
    link.href = dataURL;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// MODIFICATION : Commander sur WhatsApp AVEC IMAGE
async function checkout() {
    if (cart.length === 0) return;

    try {
        // Afficher indication de charnement
        const checkoutBtn = document.getElementById('checkoutBtn');
        const originalText = checkoutBtn.innerHTML;
        checkoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Préparation...';
        checkoutBtn.disabled = true;

        // Générer l'image de la commande
        const orderImage = await generateOrderImage();
        
        // Créer le message de commande AMÉLIORÉ
        let message = `🍽️ *NOUVELLE COMMANDE* 🍽️\n\n`;
        message += `Bonjour ! Je souhaite passer la commande suivante :\n\n`;
        
        cart.forEach((item, index) => {
            const emojis = ['🍲', '🐟', '🥩', '🦆', '🍄', '🍮', '🍫'];
            const emoji = emojis[index % emojis.length] || '🍽️';
            message += `${emoji} *${item.name}*\n`;
            message += `   Quantité: ${item.quantity}x\n`;
            message += `   Prix: ${(item.price * item.quantity).toFixed(2)}€\n\n`;
        });
        
        const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        const total = subtotal + deliveryFee;
        
        message += `📊 *RÉCAPITULATIF:*\n`;
        message += `Sous-total: ${subtotal.toFixed(2)}€\n`;
        message += `Frais de livraison: ${deliveryFee.toFixed(2)}€\n`;
        message += `*TOTAL: ${total.toFixed(2)}€*\n\n`;
        
        message += `📸 *VISUEL DE LA COMMANDE:*\n`;
        message += `Une image récapitulative a été générée !\n`;
        message += `Merci de la consulter après envoi de ce message.\n\n`;
        
        message += `🛵 *LIVRAISON:*\n`;
        message += `Merci de me confirmer le délai !\n\n`;
        
        message += `Merci ! 😊`;
        
        // Encoder le message pour URL
        const encodedMessage = encodeURIComponent(message);
        
        // Créer l'URL WhatsApp
        const whatsappURL = `https://wa.me/${whatsappNumber}?text=${encodedMessage}`;
        
        // Ouvrir WhatsApp
        window.open(whatsappURL, '_blank');
        
        // Télécharger l'image après un court délai
        setTimeout(() => {
            downloadOrderImage(orderImage);
            alert('📸 Image récapitulative téléchargée !\n\nVous pouvez maintenant l\'envoyer dans la conversation WhatsApp en cliquant sur l\'icône 📎 (pièce jointe) et en sélectionnant l\'image "commande-..."');
            
            // Réinitialiser le panier
            cart = [];
            updateCartDisplay();
        }, 2000);
        
    } catch (error) {
        console.error('Erreur:', error);
        alert('Erreur lors de la génération de la commande');
    } finally {
        // Restaurer le bouton
        const checkoutBtn = document.getElementById('checkoutBtn');
        checkoutBtn.innerHTML = '<i class="fab fa-whatsapp"></i> Commander sur WhatsApp';
        checkoutBtn.disabled = cart.length === 0;
    }
}

// Mettre à jour l'affichage du panier - MODIFIÉ POUR AFFICHER LES IMAGES
function updateCartDisplay() {
    const cartItems = document.getElementById('cartItems');
    const cartCount = document.querySelector('.cart-count');
    const subtotalEl = document.getElementById('subtotal');
    const totalEl = document.getElementById('total');
    const checkoutBtn = document.getElementById('checkoutBtn');

    // Calculer le sous-total
    const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    const total = subtotal + deliveryFee;

    // Mettre à jour les totaux
    subtotalEl.textContent = `${subtotal.toFixed(2)}€`;
    totalEl.textContent = `${total.toFixed(2)}€`;
    
    // Mettre à jour le compteur
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    cartCount.textContent = `${totalItems} article(s)`;

    // Activer/désactiver le bouton de commande
    checkoutBtn.disabled = cart.length === 0;

    // Mettre à jour la liste des articles AVEC IMAGES
    if (cart.length === 0) {
        cartItems.innerHTML = `
            <div class="empty-cart">
                <i class="fas fa-shopping-basket"></i>
                <p>Votre panier est vide</p>
                <small>Ajoutez des plats pour commander</small>
            </div>
        `;
    } else {
        cartItems.innerHTML = cart.map(item => `
            <div class="cart-item">
                <div class="item-image">
                    <img src="${item.image}" alt="${item.name}" onerror="this.style.display='none'">
                </div>
                <div class="item-details">
                    <h4>${item.name}</h4>
                    <div class="item-price">${item.price}€ × ${item.quantity}</div>
                </div>
                <div class="item-controls">
                    <div class="item-qty">
                        <button class="qty-btn-small" onclick="updateCartItem('${item.id}', -1)">-</button>
                        <span>${item.quantity}</span>
                        <button class="qty-btn-small" onclick="updateCartItem('${item.id}', 1)">+</button>
                    </div>
                    <button class="remove-item" onclick="removeFromCart('${item.id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `).join('');
    }
}

// Mettre à jour un article du panier
function updateCartItem(itemId, change) {
    const itemIndex = cart.findIndex(item => item.id === itemId);
    
    if (itemIndex > -1) {
        cart[itemIndex].quantity += change;
        
        if (cart[itemIndex].quantity <= 0) {
            cart.splice(itemIndex, 1);
        }
        
        updateCartDisplay();
    }
}

// Supprimer un article du panier
function removeFromCart(itemId) {
    cart = cart.filter(item => item.id !== itemId);
    updateCartDisplay();
}

// Modal
function showModal() {
    document.getElementById('orderModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('orderModal').style.display = 'none';
}

function scrollToCart() {
    document.querySelector('.cart-sidebar').scrollIntoView({ 
        behavior: 'smooth' 
    });
    closeModal();
}

// Événements
document.addEventListener('DOMContentLoaded', function() {
    // Bouton de commande WhatsApp
    document.getElementById('checkoutBtn').addEventListener('click', checkout);
    
    // Fermer le modal en cliquant en dehors
    window.addEventListener('click', function(event) {
        const modal = document.getElementById('orderModal');
        if (event.target === modal) {
            closeModal();
        }
    });
    
    // Initialiser l'affichage du panier
    updateCartDisplay();
});

// Fermer le modal avec ESC
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeModal();
    }
});</script>
</body>
</html>